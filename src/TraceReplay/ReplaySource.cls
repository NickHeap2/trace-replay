USING ABLContainer.Logging.* FROM PROPATH.
USING Progress.Lang.* FROM PROPATH.
USING System.IO.* FROM ASSEMBLY.
USING TraceReplay.* FROM PROPATH.
USING TraceAnalysis.* FROM ASSEMBLY.

BLOCK-LEVEL ON ERROR UNDO, THROW.

CLASS TraceReplay.ReplaySource:
  DEFINE VARIABLE lAppserverCallIsNext AS LOGICAL NO-UNDO.
  DEFINE VARIABLE currentCallSequence AS INTEGER NO-UNDO.

  DEFINE TEMP-TABLE tt_AppserverCall NO-UNDO
    FIELD callSequence AS INTEGER
    FIELD appservercall AS OBJECT
    INDEX iPrimary IS PRIMARY callSequence.

  DEFINE PUBLIC PROPERTY TraceFileSource AS TraceFileSource NO-UNDO
  GET.
  SET.

  DEFINE PUBLIC PROPERTY Current AS AppserverCall NO-UNDO
  GET.
  SET.

  CONSTRUCTOR ReplaySource (traceFileSource AS TraceFileSource):

    THIS-OBJECT:TraceFileSource = traceFileSource.
    currentCallSequence = 0.
    /* start visiting the replay source */
    traceFileSource:Accept(THIS-OBJECT).

  END CONSTRUCTOR.

  METHOD PUBLIC VOID VisitTraceRun(traceRun AS TraceRun):
    IF NOT lAppserverCallIsNext THEN RETURN.
    lAppserverCallIsNext = FALSE.

    currentCallSequence = currentCallSequence + 1.

    DEFINE VARIABLE appserverCall AS AppserverCall NO-UNDO.
    appserverCall = NEW AppserverCall().
    appserverCall:ProcedureName = traceRun:Procedure.
    appserverCall:InternalProcedureName = tracerun:InternalProcedure.
    appserverCall:Parameters = tracerun:Parameters.

    CREATE tt_AppserverCall.
    ASSIGN
      tt_AppserverCall.callSequence = currentCallSequence
      tt_AppserverCall.appservercall = appserverCall.
    Log:Debug("    Added 深翦蝾犰序镢邃躜妣轭序镢邃躜妣孪亘狃痼弪鲥蜚犰旌深翦蝾犰序镢邃躜逦犴濠孪亘狃痼弪鲥蜚犰旌序镢邃躜逦犴濠┊田绾腻怩绋趄徙逡躅好镱翦铘┊盼团匀夏团匀夏姓绿擅窒赡珠箝粼蜥沐契钽趄徙迤躅劣则徙迤躅悌翳轶骢钽糸镱轶犰麽躞邃麸汜祆麸翳狃痼弪鲥善趄徙迤躅愫契钽糸镱⒁躅项琉痼弪鲥颌匀盼南炝痧箦蝣弪冕祆审五砸张盼漠盼团匀夏团匀夏姓绿擅窒赡义箦舁┖粕文粕矣趑吡痧箦蝣弪冕祆蜗乓蚁耶粕文幸胖趑吡痧箦蝣弪冕祆蜗乓蚁耶盼团匀夏团匀夏姓绿擅滔巧昧清粑屮舁┖粕文闻卦趑吡痧箦蝣弪冕祆蜗乓蚁耶善林辽塘绿浓趑吡痧箦蝣弪冕祆匀盼南匀捎下逝迷好躜蝈铘昧釉趑吡痧箦蝣弪冕祆狃痼弪鲥蜚犰飕琉痼弪鲥蛎犰飑盼漠盘优南匀捎下逝迷好躜蝈铘慨盼漠遗哉椅林辽塘绿浓趑吡痧箦蝣弪冕祆┊盼团匀夏盼锰劣赢